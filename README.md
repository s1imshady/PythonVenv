# Виртуальные среды в Python  
## Как работать с виртуальной средой Python?
## Зачем нужны виртуальные среды?
## Что такое виртуальная среда Python?
## Как работает виртуальная среда?
## Как настроить виртуальную среду?
## Какие еще популярные варианты существуют, кроме venv?
## Как управлять виртуальными средами?
## Заключение
В этом уроке вы научитесь работать с Python vevb модуль создавать и управлять отдельными виртуальные среды для ваших проектов Python. Каждая среда может использовать разные версии зависимостей пакетов и Python. Научившись работать с виртуальными средами, вы будете знать, как помочь другим программистам воспроизвести ваши настройки разработки, и убедитесь, что ваши проекты никогда не вызывают конфликтов зависимостей друг для друга.

К концу этого урока вы будете знать, как:
- Создавать и активировать виртуальную среду Python
- Объяснять, почему вы хотите изолировать внешние зависимости
- Визуализировать, что делает Python, когда вы создаете виртуальную среду
- Настроить ваши виртуальные среды, используя дополнительные аргументы для venv
- Деактивировать и удалять виртуальные среды
- Выбирать дополнительные инструменты для управления версиями Python и виртуальными средами
Виртуальные среды — распространенный и эффективный метод, используемый при разработке Python. Лучшее понимание того, как они работают, зачем они вам нужны и что вы можете с ними делать, поможет вам освоить рабочий процесс программирования на Python.
## Как работать с виртуальной средой Python?
Если вам просто нужно запустить виртуальную среду Python, чтобы продолжить работу над любимым проектом, то этот раздел — подходящее место для вас.
В инструкциях этого руководства используетсяPython venv модуль для создания виртуальных сред. Этот модуль является частью стандартной библиотеки Python и официально рекомендуется для создания виртуальных сред, начиная с Python 3.5.  
*Примечание: Существуют и другие замечательные сторонние инструменты для создания виртуальных сред, такие какКондаивиртуальное окружение, о котором вы сможете узнать подробнее позже в этом уроке. Любой из этих инструментов может помочь вам настроить виртуальную среду Python.*  
Для базового использования,venv— отличный выбор, поскольку он уже включен в вашу установку Python. Имея это в виду, вы готовы создать свою первую виртуальную среду в этом руководстве.
### Создать виртуальную среду
Каждый раз, когда вы работаете над проектом Python, в котором используются внешние зависимости, лучше всего сначала создать виртуальную среду:  
```
Windows PowerShell
PS>python -m venv venv
```
Если вы используете Python в Windowsи  вы не настроили переменные среды, то вам может потребоваться указать полный путь к исполняемому файлу Python:  
```
Windows PowerShell 
PS>C:\Users\Name\AppData\Local\Programs\Python\Python310\python -m venv venv
```
Указанный выше системный путь предполагает, что вы установили Python 3.10 с помощью установщика Windows. Путь к исполняемому файлу Python в вашей системе может быть другим.
### Активировать виртуальную среду
Теперь у вашего проекта есть собственная виртуальная среда. Как правило, прежде чем начать его использовать, вы сначала активируете среду, выполнив сценарий, который поставляется вместе с установкой:  
```
PS>venv\scripts\acrivate
(venv) PS>
```
Прежде чем запускать эту команду, убедитесь, что вы находитесь в папке, содержащей только что созданную виртуальную среду.
*Примечание: Вы также можете работать со своей виртуальной средой, не активируя ее. Для этого укажите полный путь своему интерпретатору Python при выполнении команды. Однако чаще всего вам потребуется активировать виртуальную среду после ее создания, чтобы избавить себя от необходимости неоднократно вводить длинные пути.*
Как только вы увидите имя вашей виртуальной среды — в данном случае(venv)— в командной строке, тогда вы знаете, что ваша виртуальная среда активна. Все готово и готово к установке внешних пакетов!
### Установите пакеты
После создания и активации виртуальной среды вы можете установить любые внешние зависимости, необходимые для вашего проекта:
Эта команда является командой по умолчанию, которую следует использовать для установки внешних пакетов Python с помощьюпункт. Поскольку вы сначала создали и активировали виртуальную среду,пунктустановит пакеты в изолированное место.  
*Примечание: Поскольку вы создали свою виртуальную среду с использованием версии Python 3, вам не нужно вызывать python3 или pip3 явно.*
Поздравляем, теперь вы можете установить пакеты в свою виртуальную среду. Чтобы добраться до этого момента, вы начали с создания виртуальной среды Python с именемvenvа затем активировал его в текущем сеансе оболочки.  
Пока вы не закроете свой терминал, каждый Пакет Python который вы установите, окажется в этой изолированной среде вместо ваших глобальных site-packages Python. Это означает, что теперь вы можете работать над своим проектом Python, не беспокоясь о конфликтах зависимостей.
### Деактивировать среду
Закончив работу с этой виртуальной средой, вы можете деактивировать ее:  
```
Windows PowerShell
(venv) PS>deactivate
PS>
```
После выполнения  ваша командная строка вернется в нормальное состояние. Это изменение означает, что вы вышли из виртуальной среды. Если вы взаимодействуете с Python, теперь вы будете взаимодействовать с вашей глобально настроенной средой Python.
Если вы хотите вернуться в виртуальную среду, которую вы создали ранее, вам снова необходимо запустить скрипт активации этой виртуальной среды.  
*Примечание: Перед установкой пакета найдите имя вашей виртуальной среды в круглых скобках перед командной строкой..
Если имя отображается, значит, вы знаете, что ваша виртуальная среда активна, и вы можете установить внешние зависимости. Если вы не видите имя в командной строке, не забудьте активировать виртуальную среду Python перед установкой каких-либо пакетов.*   
На этом этапе вы рассмотрели основы работы с виртуальными средами Python. Если это все, что вам нужно, то счастливого пути к продолжению творчества!
Однако, если вы хотите знать, что именно только что произошло, почему во многих руководствах вас вообще просят создать виртуальную среду и что на самом деле представляет собой виртуальная среда Python, продолжайте читать!
## Зачем нужны виртуальные среды?
Почти все в сообществе Python предлагают использовать виртуальные среды для всех своих проектов. Но почему? Если вы хотите узнать, почему вам вообще необходимо настраивать виртуальную среду Python, то этот раздел для вас.
Короткий ответ: Python не очень хорош в управлении зависимостями. Если не конкретизировать, то pip поместит все внешние пакеты, которые вы устанавливаете, в папку в вашей базовой установке Python.
Если все ваши внешние пакеты находятся в одной папке, может возникнуть несколько проблем. В этом разделе вы узнаете больше о них, а также о других проблемах, которые решаются виртуальными средами.
### Избегайте загрязнения системы
Linux и macOS поставляются с предустановленной версией Python, которую операционная система использует для внутренних задач.
Если вы устанавливаете пакеты в глобальный Python вашей операционной системы, эти пакеты будут смешиваться с пакетами, соответствующими системе. Эта путаница может иметь неожиданные побочные эффекты для задач, имеющих решающее значение для нормального поведения вашей операционной системы.
Кроме того, если вы обновите свою операционную систему, установленные вами пакеты могут быть перезаписаны и потеряны. Вы не хотите, чтобы случилась любая из этих головных болей!
### Обход конфликтов зависимостей
Для одного из ваших проектов может потребоваться другая версия внешней библиотеки, чем другая. Если у вас есть только одно место для установки пакетов, то вы не сможете работать с двумя разными версиями одной и той же библиотеки. Это одна из наиболее распространенных причин, по которым рекомендуется использовать виртуальную среду Python.
Чтобы лучше понять, почему это так важно, представьте, что вы строите Веб-сайты Django  для двух разных клиентов. Одному клиенту нравится существующее веб-приложение, которое вы изначально создали с помощью Dlango 2.2.26, и этот клиент отказывается обновлять свой проект до современной версии Django. Другой клиент хочет, чтобы вы включили на его веб-сайт функциональность асинхронности, которая доступна только начиная с Django 4.0.
Если вы установили Django глобально, у вас может быть установлена только одна из двух версий:
```
PS> python -m pip install django==2.2.26
PS> python -m pip list
Package    Version
---------- -------
Django     2.2.26
pip        22.0.4
pytz       2022.1
setuptools 58.1.0
sqlparse   0.4.2

PS> python -m pip install django==4.0.3
PS> python -m pip list
Package    Version
---------- -------
asgiref    3.5.0
Django     4.0.3
pip        22.0.4
pytz       2022.1
setuptools 58.1.0
sqlparse   0.4.2
tzdata     2022.1
```
Если вы устанавливаете две разные версии одного и того же пакета в глобальную среду Python, вторая установка перезапишет первую. По той же причине не получится создать единую виртуальную среду для обоих клиентов. Вы не можете иметь две разные версии одного и того же пакета в одной среде Python.
Похоже, с такой настройкой вы не сможете работать над одним из двух проектов! Однако если вы создадите виртуальную среду для каждого проекта ваших клиентов, вы сможете установить в каждый из них разные версии Django:
```
PS> mkdir client-old
PS> cd client-old
PS> python -m venv venv --prompt="client-old"
PS> venv\Scripts\activate
(client-old) PS> python -m pip install django==2.2.26
(client-old) PS> python -m pip list
Package    Version
---------- -------
Django     2.2.26
pip        22.0.4
pytz       2022.1
setuptools 58.1.0
sqlparse   0.4.2
(client-old) PS> deactivate

PS> cd ..
PS> mkdir client-new
PS> cd client-new
PS> python -m venv venv --prompt="client-new"
PS> venv\Scripts\activate
(client-new) PS> python -m pip install django==4.0.3
(client-new) PS> python -m pip list
Package    Version
---------- -------
asgiref    3.5.0
Django     4.0.3
pip        22.0.4
setuptools 58.1.0
sqlparse   0.4.2
tzdata     2022.1
(client-new) PS> deactivate
```
Если вы сейчас активируете любую из двух виртуальных сред, вы заметите, что она по-прежнему содержит свою собственную версию Django. Эти две среды также имеют разные зависимости, и каждая содержит только те зависимости, которые необходимы для этой версии Django.
С помощью этой настройки вы можете активировать одну среду, когда работаете над одним проектом, и другую, когда работаете над другим. Теперь вы можете одновременно радовать любое количество клиентов!
### Минимизация проблем с воспроизводимостью
Если вы какое-то время работали с Python, то ваша глобальная среда Python уже может включать в себя всевозможные сторонние пакеты. Если это не так, то похлопайте себя по плечу! Вероятно, вы недавно установили новую версию Python или уже знаете, как работать с виртуальными средами.
Чтобы прояснить, с какими проблемами воспроизводимости вы можете столкнуться при совместном использовании среды Python в нескольких проектах, мы рассмотрим следующий пример ситуации. Представьте, что за последний месяц вы работали над двумя независимыми проектами:
1.	Проект парсинга веб-страниц с помощью Beautiful Soup
2.	Приложение Flask
Не зная о виртуальных средах, вы установили все необходимые пакеты в свою глобальную среду Python:
```
Windows PowerShell
PS> python -m pip install beautifulsoup4 requests
PS> python -m pip install flask
```
Ваше приложение Flask оказалось весьма полезным, поэтому другие разработчики тоже хотят над ним поработать. Им необходимо воспроизвести среду, которую вы использовали для работы над ним. Вы хотите идти вперед изакрепите свои зависимости, чтобы вы могли поделиться своим проектом в Интернете:
```
Windows PowerShell
PS> python -m pip freeze
beautifulsoup4==4.10.0
certifi==2021.10.8
charset-normalizer==2.0.12
click==8.0.4
colorama==0.4.4
Flask==2.0.3
idna==3.3
itsdangerous==2.1.1
Jinja2==3.0.3
MarkupSafe==2.1.1
requests==2.27.1
soupsieve==2.3.1
urllib3==1.26.9
Werkzeug==2.0.3
```
Какие из этих пакетов актуальны для вашего приложения Flask, а какие находятся здесь из-за вашего проекта по очистке веб-страниц? Трудно сказать, когда все внешние зависимости находятся в одном месте.
В такой единой среде вам придется вручную просматривать зависимости и знать, какие из них необходимы для вашего проекта, а какие нет. В лучшем случае этот подход утомителен, но, скорее всего, он подвержен ошибкам.
Если вы используете отдельную виртуальную среду для каждого из своих проектов, вам будет проще прочитать требования проекта из закрепленных зависимостей. Это означает, что вы можете поделиться своим успехом, разработав отличное приложение, позволяя другим сотрудничать с вами!
### Блокировка привилегий установки Dodge
Наконец, вам могут потребоваться права администратора на компьютере для установки пакетов в каталог site-packages хоста Python. В корпоративной рабочей среде у вас, скорее всего, не будет такого уровня доступа к машине, на которой вы работаете.
Если вы используете виртуальные среды, вы создаете новое место установки в рамках ваших пользовательских привилегий, что позволяет вам устанавливать внешние пакеты и работать с ними.
Независимо от того, занимаетесь ли вы программированием в качестве хобби на своем компьютере, разрабатываете веб-сайты для клиентов или работаете в корпоративной среде, использование виртуальной среды в долгосрочной перспективе избавит вас от многих неприятностей.
## Что такое виртуальная среда Python?
На этом этапе вы убеждены, что хотите работать с виртуальными средами. Отлично, но с чем вы работаете, когда используете виртуальную среду? Если вы хотите понять, что такое виртуальные среды Python, то этот раздел для вас.
Короткий ответ: виртуальная среда Python — это структура папок, которая дает вам все необходимое для запуска облегченной, но изолированной среды Python.
### Структура папок
Когда вы создаете новую виртуальную среду с помощью venv, Python создает автономную структуру папок и копирует символические ссылки python.
Вам не нужно глубоко копаться в этой структуре папок, чтобы узнать больше о том, из чего состоят виртуальные среды. Совсем скоро вы аккуратно соскоблите верхний слой почвы и исследуете обнаруженные вами высокоуровневые структуры.
Папка виртуальной среды содержит множество файлов и папок, но вы можете заметить, что большая часть того, что делает эту древовидную структуру такой долгой, находится внутри нее. Если вы сократите находящиеся там подпапки и файлы, вы получите не слишком громоздкую древовидную структуру:
```
venv\
│
├── Include\
│
├── Lib\
│   │
│   └── site-packages\
│       │
│       ├── _distutils_hack\
│       │
│       ├── pip\
│       │
│       ├── pip-22.0.4.dist-info\
│       │
│       ├── pkg_resources\
│       │
│       ├── setuptools\
│       │
│       ├── setuptools-58.1.0.dist-info\
│       │
│       └── distutils-precedence.pth
│
│
├── Scripts\
│   ├── Activate.ps1
│   ├── activate
│   ├── activate.bat
│   ├── deactivate.bat
│   ├── pip.exe
│   ├── pip3.10.exe
│   ├── pip3.exe
│   ├── python.exe
│   └── pythonw.exe
│
└── pyvenv.cfg
```
Эта уменьшенная древовидная структура дает вам лучшее представление о том, что происходит в папке вашей виртуальной среды:
```
Windows
-	Include\ изначально пустая папка, которую Python использует длявключить заголовочные файлы Cдля пакетов, которые вы можете установить и которые зависят от расширений C.
-	lib\site-packages\ является одной из основных причин создания виртуальной среды. В этой папке вы будете устанавливать внешние пакеты, которые хотите использовать в своей виртуальной среде. По умолчанию в вашей виртуальной среде предустановлены две зависимости:пункти инструменты настройки. Вы узнаете о них больше немного позже.
-	scripts\содержит исполняемые файлы вашей виртуальной среды. Наиболее примечательными являются интерпретатор Python (python.exe),пунктисполняемый файл (пип.exe) и сценарий активации для вашей виртуальной среды, который доступен в нескольких вариантах, позволяющих работать с разными оболочками. В этом уроке вы использовалиактивировать, который управляет активацией вашей виртуальной среды для Windows в большинстве оболочек.
-	pyvenv.cfg— это важный файл для вашей виртуальной среды. Он содержит всего пару пар ключ-значение, которые Python использует для установки переменных всистемамодуль, который определяет, какой интерпретатор Python и какой каталог site-packages будет использовать текущий сеанс Python. Вы узнаете больше о настройках этого файла, когда прочтете о том, как работает виртуальная среда.
Из этого обзора содержимого папки вашей виртуальной среды с высоты птичьего полета вы можете еще больше уменьшить масштаб и обнаружить, что существует три основные части виртуальной среды Python:
```
1.	Копия или символическая ссылка двоичного файла Python.
2.	Аpyvenv.cfgфайл
3.	Каталог site-packages
Установленные пакеты внутри site-packages/являются необязательными, но используются по умолчанию. Однако ваша виртуальная среда все равно была бы действительной виртуальной средой, если бы этот каталог был пустым, и есть способы ее создать без установки каких-либо зависимостей.
Вы можете дважды проверить, что Python установил pip и setuptools в вашу виртуальную среду с помощью pip list:
```
Windows PowerShell
(venv) PS> python -m pip list
Package    Version
---------- -------
pip        22.0.4
setuptools 58.1.0
---------- -------
```
Номера ваших версий могут отличаться, но эти выходные данные подтверждают, что Python установил оба пакета, когда вы создавали виртуальную среду с настройками по умолчанию.  
*Примечание:Ниже этого вывода pip также может отображаться предупреждение о том, что вы используете не последнюю версию модуля. Пока не беспокойтесь об этом. Позже вы узнаете больше о том, почему это происходит и как с этим бороться.*  
Эти два установленных пакета составляют большую часть содержимого вашей новой виртуальной среды. Однако вы заметите, что в папке есть еще несколько папок:
•	The_distutils_hack/module,в соответствии со своим названием, гарантирует, что при установке пакета Python выберет локальный.
•	Thepkg_resources/module помогает приложениям автоматически обнаруживать плагины и позволяет пакетам Python получать доступ к своим файлам ресурсов.
•The {name}-{version}.dist-info/ папки для pip, setuptools содержат  package distribution информацию, которая существует для записывания информации об установленных пакетах.
Наконец, есть также файл с именем distutils-precedence.pth. Этот файл помогает установить приоритет пути для distutils imports и работает вместе с_distutils_hack.  
*Примечание: Вы узнаете об этих дополнительных файлах и папках для полноты картины. Вам не нужно будет их запоминать, чтобы эффективно работать с виртуальными средами. Достаточно иметь в виду, что любые предустановленные пакеты в вашем site-packages/ являются стандартными инструментами, которые делают установку других пакетов более удобной для пользователя.*  
К этому моменту вы увидели все файлы и папки, составляющие виртуальную среду Python, если вы установили ее с помощью встроенного venv.
Имейте в виду, что ваша виртуальная среда представляет собой просто структуру папок, а это означает, что вы можете удалить и создать заново в любое время, когда захотите. Но почему именно такая структура папок и что она делает возможной?
### Изолированная установка Python
Виртуальные среды Python призваны предоставить легкую, изолированную среду Python, которую вы можете быстро создать, а затем отказаться от нее, когда она вам больше не нужна. Структура папок, которую вы видели выше, делает это возможным, предоставляя три ключевых элемента:
1. Копия или символическая ссылка двоичного файла Python
2. Аpyvenv.cfgфайл
3. Каталог site-packages  
Эта структура определяет расположение копии или символической ссылки двоичного файла Python и каталога site-packages, куда Python устанавливает внешние пакеты.  
*Примечание:Является ли исполняемый файл Python в вашей виртуальной среде копией или символической ссылкой исполняемого файла Python, на котором вы создали среду, зависит в первую очередь от вашей операционной системы.*  
Windows и Linux могут создавать символические ссылки вместо копий, тогда как macOS всегда создает копию. Вы можете попробовать влиять на поведение по умолчанию с необязательными аргументами при создании виртуальной среды. Однако в большинстве стандартных случаев вам не придется об этом беспокоиться.
В дополнение к двоичному файлу Python и каталогу site-packages вы получаете pyvenv.cfg файл. Это небольшой файл, содержащий всего пару пар ключ-значение. Однако эти настройки имеют решающее значение для работы вашей виртуальной среды:
```
Конфигурационный файл
home = C:\Users\Name\AppData\Local\Programs\Python\Python310
include-system-site-packages = false
version = 3.10.3
```
Вы узнаете больше об этом файле в следующем разделе, когда будете читать об этом файле.
Предположим, вы внимательно исследуете свою недавно созданную виртуальную среду. В этом случае вы можете заметить, что эта облегченная установка не содержит ни одной доверенной стандартной библиотеки. Кто-то может сказать, что Python без стандартной библиотеки подобен игрушечной машинке без батареек!
Однако если вы запустите интерпретатор Python из своей виртуальной среды, вы все равно сможете получить доступ ко всем возможностям стандартной библиотеки:
```
Python
>>> import urllib
>>> from pprint import pp
>>> pp(dir(urllib))
['__builtins__',
 '__cached__',
 '__doc__',
 '__file__',
 '__loader__',
 '__name__',
 '__package__',
 '__path__',
 '__spec__']
```
В приведенном выше фрагменте кода вы успешно импортируете оба модуля urllib() и pp(). Затем вы используете dir() чтобы осмотреть URLlib модуль.
Оба модуля являются частью стандартной библиотеки, так как же у вас есть доступ к ним, даже если они не находятся в структуре папок вашей виртуальной среды Python?
Вы можете получить доступ к модулям стандартной библиотеки Python, поскольку ваша виртуальная среда повторно использует встроенные модули Python и модули стандартной библиотеки из установки Python, из которой вы создали свою виртуальную среду. В следующем разделе вы узнаете, как виртуальная среда обеспечиваетссылка на стандартную библиотеку вашего базового Python.  
*Примечание:Поскольку для создания виртуальной среды вам всегда нужна существующая установка Python,venv предпочитает повторно использовать существующие модули стандартной библиотеки, чтобы избежать накладных расходов на их копирование в новую виртуальную среду. Это намеренное решение ускоряет создание виртуальных сред и делает их более легкими.*  
Помимо стандартных модулей библиотеки, вы можете опционально предоставить вашей виртуальной среде доступ к site-packages базовой установки через аргумент при создании среды:
```
Windows PowerShell
PS C:\> python -m venv venv --system-site-packages
```
## Как работает виртуальная среда? 
Если вы знаете, что такое виртуальная среда Python, но хотите создать облегченную изоляцию, которую она обеспечивает, то вы попали в правильный раздел. 
### Он копирует структуру и файлы
Когда вы создаете виртуальную среду с помощью venv, модуль заново создает файл и структуру папок установки Python в вашей операционной системе. Python также копирует или символизирует в эту структуру папок исполняемый файл Python, с помощью которого вы вызвали venv:
```
venv\
│
├── Include\
│
├── Lib\
│   │
│   └── site-packages\
│
├── Scripts\
│   ├── Activate.ps1
│   ├── activate
│   ├── activate.bat
│   ├── deactivate.bat
│   ├── pip.exe
│   ├── pip3.10.exe
│   ├── pip3.exe
│   ├── python.exe
│   └── pythonw.exe
│
└── pyvenv.cfg
```
Если вы найдете общесистемную установку Python в своей операционной системе и проверите структуру папок там, вы увидите, что ваша виртуальная среда похожа на эту структуру.  
*Примечание:В Windows вы можете заметить, что python.exe в вашей базовой установке Python нет scripts\ но он находится на один уровень выше. В вашей виртуальной среде исполняемый файл намеренно расположен в папке scripts\folder.*    
Это небольшое изменение в структуре папок означает, что вам нужно добавить в оболочку только один каталог.
Хотя в вашей базовой установке Python вы можете найти некоторые дополнительные файлы и папки, вы заметите, что стандартная структура папок такая же, как и в вашей виртуальной среде. venv создает эту структуру папок, чтобы гарантировать, что Python будет работать должным образом изолированно, без необходимости внесения множества дополнительных изменений.
### Он адаптирует процесс поиска префикса
При наличии стандартной структуры папок интерпретатор Python в вашей виртуальной среде может понять, где находятся все нужные файлы. Он делает это лишь с небольшими изменениями в своем процессе поиска префиксов в соответствии со спецификацией venv.
Вместо того чтобы искать модуль os для определения местоположения стандартной библиотеки, интерпретатор Python сначала ищет файл pyvenv.cfg. Если интерпретатор находит этот файл и в нем содержится ключ home, то интерпретатор использует этот ключ для установки значения двух переменных:
1. sys.base_prefix будет содержать путь к исполняемому файлу Python, используемому для создания этой виртуальной среды, который можно найти по пути, заданному ключом home в файле pyvenv.cfg.
2. sys.prefix будет указывать на каталог, содержащий pyvenv.cfg.
Если интерпретатор не находит файл pyvenv.cfg, то он определяет, что работает не в виртуальной среде, и тогда и sys.base_prefix, и sys.prefix будут указывать на один и тот же путь.
### Он ссылается на вашу стандартную библиотеку.
Виртуальные среды Python - это легкий способ предоставить вам изолированную среду Python, которую вы можете быстро создать, а затем удалить, когда она вам больше не нужна. Чтобы сделать это возможным, venv копирует только минимально необходимые файлы.
Исполняемый файл Python в вашей виртуальной среде имеет доступ к стандартным библиотечным модулям той установки Python, на которой основана среда. Python делает это возможным, указывая путь к файлу базового исполняемого файла Python в настройке home в файле pyvenv.cfg:
```
Windows
home = C:\Users\Name\AppData\Local\Programs\Python\Python310
include-system-site-packages = false
версия = 3.10.3
```
Если вы перейдете по пути, указанному в выделенной строке в файле pyvenv.cfg, и просмотрите содержимое папки, то найдете базовый исполняемый файл Python, который вы использовали для создания виртуальной среды. Оттуда можно перейти к папке, содержащей модули стандартной библиотеки:
```
Windows Powershell
PS> ls C:\Users\Name\AppData\Local\Programs\Python\Python310

 Directory: C:\Users\Name\AppData\Local\Programs\Python\Python310

Mode              LastWriteTime      Length Name
----              -------------      ------ ----
d-----     12/19/2021   5:09 PM             DLLs
d-----     12/19/2021   5:09 PM             Doc
d-----     12/19/2021   5:09 PM             include
d-----     12/19/2021   5:09 PM             Lib
d-----     12/19/2021   5:09 PM             libs
d-----     12/21/2021   2:04 PM             Scripts
d-----     12/19/2021   5:09 PM             tcl
d-----     12/19/2021   5:09 PM             Tools
-a----      12/7/2021   4:28 AM       32762 LICENSE.txt
-a----      12/7/2021   4:29 AM     1225432 NEWS.txt
-a----      12/7/2021   4:28 AM       98544 python.exe
-a----      12/7/2021   4:28 AM       61680 python3.dll
-a----      12/7/2021   4:28 AM     4471024 python310.dll
-a----      12/7/2021   4:28 AM       97008 pythonw.exe
-a----      12/7/2021   4:29 AM       97168 vcruntime140.dll
-a----      12/7/2021   4:29 AM       37240 vcruntime140_1.dll

PS> ls C:\Users\Name\AppData\Local\Programs\Python\Python310\Lib

 Directory: C:\Users\Name\AppData\Local\Programs\Python\Python310\Lib

Mode              LastWriteTime      Length Name
----              -------------      ------ ----
d-----     12/19/2021   5:09 PM             asyncio
d-----     12/19/2021   5:09 PM             collections

# ...

-a----      12/7/2021   4:27 AM        5302 __future__.py
-a----      12/7/2021   4:27 AM          65 __phello__.foo.py
```
Python настроен на поиск этих модулей путем добавления соответствующего пути в sys.path. При инициализации Python автоматически импортирует site модуль, который устанавливает значения по умолчанию для этого аргумента.
Пути, к которым ваша сессия Python имеет доступ в sys.path, определяют, из каких мест Python может импортировать модули.
Если вы активируете виртуальную среду и войдете в интерпретатор Python, то сможете убедиться, что путь к папке стандартной библиотеки вашей базовой установки Python доступен:
```
Python
>>> import sys
>>> from pprint import pp
>>> pp(sys.path)
['',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310\\python310.zip',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310\\DLLs',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310\\lib',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310',
 'C:\\Users\\Name\\path\\to\\venv',
 'C:\\Users\\Name\\path\\to\\venv\\lib\\site-packages']
```
Поскольку путь к каталогу, содержащему модули стандартной библиотеки, доступен в sys.path, вы сможете импортировать любой из них при работе с Python из виртуальной среды.
### Он изменяет ваш PYTHONPATH
Чтобы убедиться, что скрипты, которые вы хотите запустить, используют интерпретатор Python в вашем виртуальном окружении, venv изменяет переменную окружения PYTHONPATH, доступ к которой вы можете получить с помощью sys.path.
Если вы посмотрите на эту переменную без активной виртуальной среды, вы увидите пути по умолчанию для вашей стандартной установки Python:
```
Python
>>> import sys
>>> from pprint import pp
>>> pp(sys.path)
['',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310\\python310.zip',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310\\DLLs',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310\\lib',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310',
 'C:\\Users\\Name\\AppData\\Roaming\\Python\\Python310\\site-packages',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages']
```
Однако если вы активируете виртуальную среду перед запуском другого сеанса интерпретатора и повторно выполните те же команды, то получите другой результат:
```
Python
>>> import sys
>>> from pprint import pp
>>> pp(sys.path)
['',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310\\python310.zip',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310\\DLLs',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310\\lib',
 'C:\\Users\\Name\\AppData\\Local\\Programs\\Python\\Python310',
 'C:\\Users\\Name\\path\\to\\venv',
 'C:\\Users\\Name\\path\\to\\venv\\lib\\site-packages']
```
Python заменил стандартный путь к каталогу site-packages на тот, который находится в вашей виртуальной среде. Это изменение означает, что Python будет загружать любые внешние пакеты, установленные в вашей виртуальной среде. И наоборот, поскольку путь к директории site-packages вашего базового Python больше не находится в этом списке, Python не будет загружать оттуда модули.
Это изменение в настройках пути Python эффективно создает изоляцию внешних пакетов в вашей виртуальной среде.
В качестве опции вы можете получить доступ только для чтения к системному каталогу site-packages вашей базовой установки Python, передав соответствующий аргумент при создании виртуальной среды.
### Изменяет переменную Shell PATH при активации
Для удобства вы обычно активируете виртуальную среду перед работой в ней, хотя это и не обязательно.
Чтобы активировать виртуальную среду, необходимо выполнить скрипт активации:
```
Windows Powershell
PS> venv\Scripts\activate
(venv) PS>
```
Выбор сценария активации зависит от вашей операционной системы и используемой оболочки.
Если вы покопаетесь в структуре папок вашей виртуальной среды, то найдете несколько различных сценариев активации, которые поставляются вместе с ней:
```
Windows
venv\
│
├── Include\
│
├── Lib\
│
├── Scripts\
│   ├── Activate.ps1
│   ├── activate
│   ├── activate.bat
│   ├── deactivate.bat
│   ├── pip.exe
│   ├── pip3.10.exe
│   ├── pip3.exe
│   ├── python.exe
│   └── pythonw.exe
│
└── pyvenv.cfg
```
Все эти сценарии активации имеют одну и ту же цель. Однако они должны предоставлять различные способы достижения этой цели из-за различных операционных систем и оболочек, с которыми работают пользователи.
В сценарии активации происходят два критических действия:
1. Path: Он устанавливает переменную VIRTUAL_ENV в путь к корневой папке вашей виртуальной среды и добавляет относительное расположение исполняемого файла Python в PATH.
2. Командная строка: Изменяет командную строку на имя, которое вы передали при создании виртуальной среды. Оно берет это имя и заключает его в круглые скобки, например (venv).
Эти изменения обеспечивают удобство работы с виртуальными средами в вашей оболочке:
- Путь: Поскольку путь ко всем исполняемым файлам в вашей виртуальной среде теперь находится в начале PATH, ваша оболочка будет вызывать внутренние версии pip или Python, когда вы просто набираете pip или python.
- Командная строка: Поскольку сценарий изменил командную строку, вы быстро узнаете, активирована ли ваша виртуальная среда.
Оба эти изменения являются незначительными адаптациями, которые существуют исключительно для вашего удобства. Они не являются строго необходимыми, но делают работу с виртуальными средами Python более приятной.
Вы можете проверить переменную PATH до и после активации виртуальной среды. Если вы активировали виртуальную среду, то в начале PATH вы увидите путь к папке, содержащей ваши внутренние исполняемые файлы:
```
PS> $Env:Path
C:\Users\Name\path\to\venv\Scripts;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Users\Name\AppData\Local\Programs\Python\Python310\Scripts\;C:\Users\Name\AppData\Local\Programs\Python\Python310\;c:\users\name\.local\bin;c:\users\name\appdata\roaming\python\python310\scripts
```
Имейте в виду, что результат печати переменной PATH, скорее всего, будет выглядеть совсем иначе. Важно то, что сценарий активации добавил путь к вашей виртуальной среде в начало переменной PATH.
Когда вы деактивируете виртуальное окружение с помощью команды deactivate, ваша оболочка отменяет эти изменения и возвращает PATH и командную строку в прежнее состояние.
Запускается из любого места с абсолютными путями
Чтобы использовать виртуальную среду, ее не нужно активировать. Вы можете работать с виртуальной средой без ее активации, хотя ее активация - это обычное действие, которое часто рекомендуется.
Если вы укажете оболочке только имя исполняемого файла, она будет искать исполняемый файл с таким именем в PATH. Затем он выберет и запустит первый, который соответствует этому критерию.
Сценарий активации изменяет переменную PATH таким образом, чтобы папка binaries вашего виртуального окружения была первым местом, где ваша оболочка ищет исполняемые файлы. Это изменение позволит вам набирать только pip или python для запуска соответствующих программ, расположенных в вашем виртуальном окружении.
Если вы не активировали виртуальное окружение, то для запуска любого скрипта из виртуального окружения вы можете указать абсолютный путь к исполняемому файлу Python внутри виртуального окружения:
```
PS> C:\Users\Name\path\to\venv\Scripts\python.exe
```
Эта команда запустит интерпретатор Python в вашей виртуальной среде точно так же, как если бы вы сначала активировали виртуальную среду, а затем вызвали ее с помощью python.
Встраивание активации виртуальной среды в скрипт - суетливое занятие, которое чаще идет не так, чем не так. Вместо этого, вооружившись знаниями, полученными в этом уроке, вы можете использовать абсолютный путь к интерпретатору Python в вашей виртуальной среде при запуске сценария.
Это можно использовать, например, если вы настраиваете почасовое задание CRON на удаленном Linux-сервере, которое асинхронно проверяет подключение к сайту с помощью внешнего пакета aiohttp, установленного в виртуальной среде:
```
0 * * * *
    /home/name/Documents/connectivity-checker/venv/bin/python
    -m rpchecker
    -u google.com twitter.com
    -a
```
Вам не нужно возиться с активацией виртуальной среды, чтобы использовать нужный интерпретатор Python, имеющий доступ к зависимостям, которые вы установили в виртуальной среде. Вместо этого вы просто передаете абсолютный путь к двоичному файлу этого интерпретатора. Python позаботится обо всем остальном во время инициализации.
Пока вы указываете путь к исполняемому файлу Python, вам не нужно активировать виртуальную среду, чтобы воспользоваться преимуществами ее использования.
## Как настроить виртуальную среду?
Если вы уверены в том, что такое виртуальная среда Python, и хотите настроить ее для конкретного случая использования, то вы попали по адресу. В этом разделе вы узнаете о дополнительных аргументах, которые можно передавать при создании виртуальной среды с помощью venv, и о том, как эти настройки могут помочь вам получить именно ту виртуальную среду, которая вам нужна.
### Изменение командной строки
Вы можете изменить имя папки, содержащей ваше виртуальное окружение, когда создаете его, передав имя, отличное от venv. На самом деле, в разных проектах часто встречаются разные имена. Некоторые из них широко используются:
- venv
- env
- .venv
Вы можете назвать папку, созданную для виртуальной среды, как угодно.
Какое бы имя вы ни выбрали, оно будет отображаться в командной строке после активации виртуальной среды:
```
Windows Powershell
PS> python -m venv your-fancy-name
PS> your-fancy-name\Scripts\activate
(your-fancy-name) PS>
```
Если вы дадите папке виртуальной среды альтернативное имя, вам также нужно будет учитывать это имя при запуске сценария активации, как показано в примере кода выше.
Если вы хотите, чтобы вам было удобно видеть другую командную строку, но при этом имя папки должно быть описательным, чтобы вы знали, что в ней находится виртуальная среда, то вы можете передать желаемое имя командной строки в параметр --prompt:
```
Windows Powershell
PS> python -m venv venv --prompt="dev-env"
PS> venv\Scripts\activate
(dev-env) PS>
```
Используя дополнительный аргумент --prompt, вы можете установить командную строку, которая будет отображаться при активации виртуальной среды, в описательную строку без изменения имени папки виртуальной среды.
В приведенном выше фрагменте кода видно, что вы по-прежнему называете папку venv, а значит, сможете обращаться к сценарию activate по привычному пути. В то же время командная строка, появляющаяся после активации, будет такой, какую вы передали в параметре --prompt
Переведено с помощью www.DeepL.com/Translator (бесплатная версия)
### Перезапись существующих сред
В любой момент вы можете захотеть удалить и заново создать одно из своих виртуальных окружений. Если вы часто так делаете, то вам будет полезно узнать, что вы можете добавить аргумент --clear, чтобы удалить содержимое существующей среды до того, как Python создаст новую.
Прежде чем вы попробуете это сделать, полезно убедиться, что выполнение команды создания нового виртуального окружения без этого аргумента не перезапишет существующее виртуальное окружение с тем же именем:
```
PS> python -m venv venv
PS> venv\Scripts\pip.exe install requests
PS> venv\Scripts\pip.exe list
Package            Version
------------------ ---------
certifi            2021.10.8
charset-normalizer 2.0.12
idna               3.3
pip                22.0.4
requests           2.27.1
setuptools         58.1.0
urllib3            1.26.9

PS> python -m venv venv
PS> venv\Scripts\pip.exe list
Package            Version
------------------ ---------
certifi            2021.10.8
charset-normalizer 2.0.12
idna               3.3
pip                22.0.4
requests           2.27.1
setuptools         58.1.0
urllib3            1.26.9
```
В этом примере кода вы сначала создали виртуальную среду под названием venv, затем использовали внутреннюю среду pip для установки requests в каталог site-packages вашей виртуальной среды. Затем вы использовали pip list, чтобы подтвердить, что request был установлен вместе с его зависимостями.
Можно было бы ожидать, что venv уведомит вас о существовании существующей виртуальной среды по тому же пути, но он этого не делает. Вы могли бы ожидать, что venv автоматически удалит существующую виртуальную среду с тем же именем и заменит ее новой, но он не делает этого. Вместо этого, когда venv находит существующую виртуальную среду с тем же именем по указанному вами пути, он ничего не делает - и опять же, не сообщает вам об этом.
Если вы выведете список установленных пакетов после выполнения команды создания виртуальной среды во второй раз, то заметите, что requests и его зависимости все еще присутствуют. Возможно, это не то, чего вы хотите добиться.
Вместо того чтобы переходить в папку с виртуальным окружением и удалять его, вы можете явно перезаписать существующее виртуальное окружение с помощью команды --clear:
```
PS> python -m venv venv
PS> venv\Scripts\pip.exe install requests
PS> venv\Scripts\pip.exe list
Package            Version
------------------ ---------
certifi            2021.10.8
charset-normalizer 2.0.12
idna               3.3
pip                22.0.4
requests           2.27.1
setuptools         58.1.0
urllib3            1.26.9

PS> python -m venv venv --clear
PS> venv\Scripts\pip.exe list
Package    Version
---------- -------
pip        22.0.4
setuptools 58.1.0
```
Используя тот же пример, что и раньше, вы добавили необязательный аргумент --clear при выполнении команды создания во второй раз.
После этого вы убедились, что Python автоматически удалил существующую виртуальную среду с тем же именем и создал новую виртуальную среду по умолчанию без ранее установленных пакетов.
### Создание нескольких виртуальных сред одновременно
Если одной виртуальной среды недостаточно, вы можете создать несколько отдельных виртуальных сред за один раз, передав в команду несколько путей:
```
PS> python -m venv venv C:\Users\Name\Documents\virtualenvs\venv-copy
```
Выполнение этой команды создает две отдельные виртуальные среды в двух разных местах. Эти две папки являются независимыми папками виртуальных сред. Таким образом, передача более одного пути избавляет вас от необходимости набирать команду создания несколько раз.
В примере, показанном выше, вы можете заметить, что первый аргумент, venv, представляет собой относительный путь. Второй аргумент, наоборот, использует абсолютный путь, указывающий на новое местоположение папки. При создании виртуальной среды подходит любой из вариантов. Можно даже смешивать и подбирать варианты, как это было сделано здесь.
### Обновление основных зависимостей
Когда вы создали виртуальную среду Python с помощью venv и его настроек по умолчанию, а затем установили внешний пакет с помощью pip, вы, скорее всего, столкнулись с сообщением о том, что ваша установка pip устарела:
```
WARNING: You are using pip version 21.2.4; however, version 22.0.4 is available.
You should consider upgrading via the
'C:\Users\Name\path\to\venv\Scripts\python.exe -m pip install --upgrade pip' command.
```
Бывает обидно, когда создаешь что-то новое, а потом видишь, что оно уже устарело! Почему так происходит?
Установка pip, которую вы получите при создании виртуальной среды с конфигурацией venv по умолчанию, скорее всего, устарела, потому что venv использует ensurepip для загрузки pip в вашу виртуальную среду.
ensurepip намеренно не подключается к интернету, а использует колесо pip, которое поставляется в комплекте с каждым новым выпуском CPython. Поэтому цикл обновления поставляемого в комплекте pip отличается от цикла обновления независимого проекта pip.
Когда вы устанавливаете внешний пакет с помощью pip, программа подключается к PyPI и определяет, не устарел ли сам pip. Если pip устарел, то вы получите предупреждение, показанное выше.
Хотя использование загрузочной версии pip может быть полезным в некоторых случаях, вы можете захотеть установить последнюю версию pip, чтобы избежать потенциальных проблем с безопасностью или ошибок, которые могут сохраниться в старой версии. Для существующей виртуальной среды вы можете следовать инструкциям, которые pip выводит в терминал, и использовать pip для самостоятельного обновления.
Если вы хотите сэкономить усилия на выполнении этой операции вручную, вы можете указать, что хотите, чтобы pip связался с PyPI и обновил себя сразу после установки, передав аргумент --upgrade-deps:
```
PS> python -m venv venv --upgrade-deps
PS> venv\Scripts\activate
(venv) PS> python -m pip install --upgrade pip
Requirement already satisfied: pip in c:\users\name\path\to\venv\lib\site-packages (22.0.4)
```
Предположим, что при создании виртуальной среды вы используете дополнительный аргумент --upgrade-deps. В этом случае она автоматически опросит PyPI на предмет новейших версий pip и setuptools и установит их, если локальное колесо не обновлено.
Исчезнет назойливое предупреждение, и вы сможете быть уверены, что используете самую последнюю версию pip.
### Избегайте установки pip
Вы можете удивиться, почему создание виртуальной среды Python занимает много времени, ведь все, что нужно сделать, - это создать структуру папок. Причина задержки в основном заключается в установке pip. pip и его зависимости имеют большой размер и увеличивают размер вашей виртуальной среды с нескольких килобайт до многих мегабайт!
В большинстве случаев вы захотите, чтобы pip был установлен в вашей виртуальной среде, потому что вы, вероятно, будете использовать его для установки внешних пакетов из PyPI. Однако если по каким-то причинам вам не нужен pip, вы можете использовать команду --without-pip, чтобы создать виртуальное окружение без него:
```
PS> python -m venv venv --without-pip
PS> Get-ChildItem venv | Measure-Object -Property length -Sum

Count    : 1
Average  :
Sum      : 120
Maximum  :
Minimum  :
Property : Length
```
### Включите системные сайт-пакеты
В некоторых ситуациях вы можете захотеть сохранить доступ к каталогу site-packages вашего базового Python, а не разрывать эту связь. Например, возможно, вы уже установили пакет, который компилируется при установке, такой как Bokeh, в ваше глобальное окружение Python.
Bokeh является вашей любимой библиотекой для исследования данных, и вы используете ее во всех своих проектах. Вы по-прежнему хотите держать проекты своих клиентов в отдельных средах, но установка Bokeh в каждую из них может занять пару минут. Для быстрой итерации вы хотите иметь доступ к существующей установке Bokeh без необходимости переделывать ее для каждой виртуальной среды, которую вы создаете.
Вы можете получить доступ ко всем модулям, которые вы установили в каталог site-packages вашего базового Python, добавив флаг --system-site-packages при создании виртуальной среды.
### Копирование или связывание исполняемых файлов
Получите ли вы копию или симлинк исполняемых файлов Python, зависит от операционной системы, в которой вы работаете:
Windows может создать как симлинк, так и копию, но некоторые версии не поддерживают симлинки. Для создания симлинков могут потребоваться привилегии администратора.
Дистрибутивы Linux могут создавать как симлинки, так и копии и часто предпочитают симлинки копиям.
macOS всегда создает копию двоичных файлов.
В PEP 405 упоминаются преимущества создания симлинков:
Симлинки предпочтительнее, когда это возможно, поскольку в случае обновления базовой установки Python исполняемый файл Python, скопированный в venv, может оказаться несовместимым с установленной стандартной библиотекой и потребовать ручного обновления. (Источник)
Хотя может быть полезно связать исполняемые файлы симлинками, чтобы они автоматически синхронизировались, даже если вы обновите базовую установку Python, дополнительные неудобства такого подхода могут перевесить его пользу. Например, когда вы дважды щелкнете python.exe в Windows, операционная система с готовностью разрешит симлинк и проигнорирует вашу виртуальную среду.
Скорее всего, вам никогда не придется прибегать к этим аргументам, но если у вас есть веские причины для принудительного использования симлинков или копий по сравнению со стандартными настройками операционной системы, то вы можете это сделать:
- --symlinks будет пытаться создавать симлинки вместо копий. Эта опция не будет иметь никакого эффекта на сборках macOS.
- --copies будет пытаться создать копии двоичных файлов Python вместо того, чтобы связывать их с исполняемыми файлами базовой установки Python.
Вы можете передать любой из этих необязательных аргументов при создании виртуальной среды.
### Обновите свой Python, чтобы он соответствовал системному Python
Если вы создали виртуальную среду, используя копии, а не симлинки, и позже обновили базовую версию Python в своей операционной системе, вы можете столкнуться с несоответствием версий стандартных библиотечных модулей.
Модуль venv предлагает решение этой проблемы. Необязательный аргумент --upgrade позволяет сохранить каталог site-packages нетронутым, обновляя бинарные файлы до новых версий в вашей системе:
```
PS> python -m venv venv --upgrade
```
## Какие еще популярные варианты существуют, кроме venv?
Модуль venv - это отличный способ работы с виртуальными средами Python. Одно из его главных преимуществ заключается в том, что venv поставляется вместе с Python, начиная с версии 3.3. Но это не единственная возможность, которая у вас есть. Вы можете использовать другие инструменты для создания и работы с виртуальными средами в Python.
В этом разделе вы узнаете о двух популярных инструментах. Они имеют разную сферу применения, но оба часто используются для тех же целей, что и модуль venv:
Virtualenv является надмножеством venv и служит основой для его реализации. Это мощный, расширяемый инструмент для создания изолированных окружений Python.
Conda предлагает управление пакетами, зависимостями и окружением для Python и других языков.
У них есть некоторые преимущества перед venv, но они не входят в стандартную установку Python, поэтому вам придется устанавливать их отдельно.
### Проект Virtualenv
Virtualenv - это инструмент, который был специально создан для создания изолированных окружений Python. Он долгое время был любим сообществом Python и предшествовал встроенному модулю venv.
Пакет является надстройкой над venv, которая позволяет делать все то, что можно делать с помощью venv, и даже больше. Virtualenv позволяет:
быстрее создавать виртуальные среды
Обнаруживать установленные версии Python без необходимости указывать абсолютный путь
Обновлять инструмент с помощью pip
Расширять функциональность инструмента самостоятельно
Любая из этих дополнительных функций может пригодиться вам при работе над проектами на Python. Возможно, вы даже захотите сохранить чертеж virtualenv в коде вместе с проектом, чтобы облегчить воспроизведение. Virtualenv имеет богатый программный API, который позволяет описывать виртуальные среды, не создавая их.
После установки virtualenv на вашу систему вы можете создать и активировать новое виртуальное окружение аналогично тому, как вы делаете это с помощью venv:
```
PS> virtualenv venv
created virtual environment CPython3.10.3.final.0-64 in 312ms
  creator CPython3Windows(dest=C:\Users\Name\path\to\venv, clear=False, no_vcs_ignore=False, global=False)
  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=C:\Users\Name\AppData\Local\pypa\virtualenv)
    added seed packages: pip==22.0.4, setuptools==60.10.0, wheel==0.37.1
  activators BashActivator,BatchActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator
PS> Set-ExecutionPolicy Unrestricted -Scope Process
PS> venv\Scripts\activate
(venv) PS>
```
### Менеджер пакетов и окружений Conda
Conda предлагает вам альтернативный подход к управлению пакетами и окружением. Хотя этот инструмент в первую очередь ассоциируется с сообществом специалистов по науке о данных и дистрибутивом Anaconda Python, его потенциальные возможности использования выходят за рамки этого сообщества и не ограничиваются установкой пакетов Python:
Управление пакетами, зависимостями и окружением для любого языка - Python, R, Ruby, Lua, Scala, Java, JavaScript, C/ C++, FORTRAN и других. (Источник)
Хотя вы также можете использовать conda для создания изолированной среды для установки пакетов Python, это лишь одна из возможностей инструмента:
pip устанавливает пакеты python внутри среды; conda устанавливает любой пакет внутри среды conda. (Источник)
Как вы можете понять из этой цитаты, conda выполняет эту изоляцию иначе, чем модуль venv и проект virtualenv.
### Как управлять виртуальными средами?
Если вы усвоили всю информацию из предыдущих разделов, но не знаете, как справиться с множеством папок окружения, которые начали скапливаться в вашей системе, продолжайте читать дальше.
В этом разделе вы узнаете, как извлечь основную информацию о вашей виртуальной среде в один файл, чтобы можно было быстро удалить и заново создать папку виртуальной среды в любое время и на любом компьютере.
Вы также узнаете о двух различных способах организации хранения папок виртуальных сред и о некоторых популярных инструментах сторонних производителей, которые помогут вам управлять виртуальными средами.
### Относитесь к ним как к одноразовым материалам
Виртуальные среды - это одноразовые структуры папок, которые можно безопасно удалять и создавать заново в любое время без потери информации о вашем проекте.
Это означает, что обычно вы не помещаете в виртуальное окружение никакой дополнительный код или информацию вручную. Все, что туда попадает, должно быть обработано вашим менеджером пакетов, которым обычно является pip или conda.
Вы также не должны фиксировать виртуальное окружение в системе контроля версий и поставлять его вместе с проектом.
Поскольку виртуальные среды не являются полностью самодостаточными установками Python, а полагаются на стандартную библиотеку базового Python, вы не создадите переносимое приложение, распространяя виртуальную среду вместе с кодом.
### Избегайте виртуальных сред в производстве
Вы можете задаться вопросом, как включить и активировать виртуальную среду при развертывании проекта в производстве. В большинстве случаев вы не хотите включать папку виртуальной среды в удаленные онлайн-ресурсы:
GitHub: Не размещайте папку venv/ на GitHub.
CI/CD Pipelines: Не включайте папку виртуального окружения в конвейеры непрерывной интеграции или непрерывной доставки.
Развертывание серверов: Не создавайте виртуальную среду на сервере развертывания, если только вы сами не управляете этим сервером и не запускаете на нем несколько отдельных проектов.
Вам все равно нужны изолированные среды и воспроизводимость кодовых проектов. Вы добьетесь этого, прикрепляя свои зависимости вместо того, чтобы включать в виртуальную среду папки, с которыми вы работали локально.
Большинство провайдеров удаленного хостинга, включая инструменты конвейеров CI/CD и провайдеров платформы как услуги (PaaS), таких как Heroku или Google App Engine (GAE), автоматически создадут такую изоляцию для вас.
Когда вы размещаете свой проект на одном из таких хостингов, сервис часто выделяет виртуальную часть сервера для вашего приложения. Такие виртуализированные серверы являются изолированными средами по своей конструкции, что означает, что ваш код по умолчанию будет выполняться в отдельной среде.
В большинстве хостинговых решений вам не придется заниматься созданием изоляции, но вам все равно нужно будет предоставить информацию о том, что установить в удаленном окружении. Для этого часто используются прикрепленные зависимости в файле requirements.txt.
## Заключение
Поздравляем вас с завершением этого урока по виртуальным средам Python. На протяжении всего урока вы получили полное представление о том, что такое виртуальные среды, зачем они нужны, как они функционируют и как управлять ими в вашей системе.
В этом уроке вы узнали, как:
- Создавать и активировать виртуальную среду Python
- Объяснять, зачем нужно изолировать внешние зависимости
- Визуализировать, что делает Python при создании виртуальной среды
- Настраивать виртуальные среды с помощью дополнительных аргументов в venv
- Деактивировать и удалять виртуальные среды
- Выбирать дополнительные инструменты для управления версиями Python и виртуальными средами  
В следующий раз, когда учебник посоветует вам создать и активировать виртуальную среду, вы сможете лучше понять, почему это хорошее предложение и что Python делает для вас за кулисами.
